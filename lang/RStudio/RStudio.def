Bootstrap: library
From: debian:10

%environment
    LC_ALL="C"
    export LC_ALL

%post
    apt-get update
    apt -y install systemd systemd-sysv gdebi-core procps libssl1.1 libnss3 \
           libasound2 ed wget curl libqt5webkit5 libqt5core5a r-base r-base-dev

    wget -O /rstudio-2023.03.0-386-amd64.deb \
      https://download1.rstudio.org/electron/bionic/amd64/rstudio-2023.03.0-386-amd64.deb
    apt -y install /rstudio-2023.03.0-386-amd64.deb

    wget -O /rstudio-server-2023.03.0-386-amd64.deb \
      https://download2.rstudio.org/server/bionic/amd64/rstudio-server-2023.03.0-386-amd64.deb 
    gdebi -n /rstudio-server-2023.03.0-386-amd64.deb

    # Setup the "general" CRAN repo
    echo 'local({
 r <- getOption("repos")
 r["CRAN"] = "https://cran.us.r-project.org"
 options(repos = r)
})' >> /etc/R/Rprofile.site

    # We are setting up a normal user for access
    # Login: rstudio  Password: rstudio
    useradd -c "RStudio Account" -u 500 -d /home/rstudio -s /bin/bash rstudio
    echo "rstudio:rstudio" | /usr/sbin/chpasswd

    # Move systemd service file into place
    cp /usr/lib/rstudio-server/extras/systemd/rstudio-server.service /lib/systemd/system/
    systemctl enable rstudio-server

    # Remove unneeded source packages
    rm -f /rstudio-2023.03.0-386-amd64.deb
    rm -f /rstudio-server-2023.03.0-386-amd64.deb

%runscript
    /usr/bin/rstudio "$@"

%startscript
    /usr/lib/rstudio-server/bin/rserver "$@"
